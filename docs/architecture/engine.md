# Engine

**Engine** · `cmd/`

Слой запуска и оркестрации. Знает как приложение рождается, работает и умирает — но не знает что делает бизнес.

---

## Концепт

Engine — слой в котором происходит оркестрация нашей системы, здесь инициализируются все слои, запускаются и завершают свою работу. 

Engine определяет правила по которым будет работать логика системы, будет ли это http-server, rabbit-queue-consumer, scheduler-worker, cli или все вместе 

Engine определяет что будет находиться в delivery, эндпоинты, обработчики очередей или события внутри системы, но никак не описывает их работу, просто импортирует и запускает в систему

### Сущности
**Main** — единственная точка которая знает обо всём. Собирает конфиги слоёв, инициализирует их в строгом порядке, запускает Apps, останавливает при завершении.

**Apps** — каждый App оборачивает одну технологию взаимодействия. Знает когда передать управление в Realm, гарантирует работоспособность транспорта, обрабатывает результаты.


---

## Структура

```
cmd/
├── main/               — дирижёр: конфиги, порядок init/stop, запуск Apps
    ├── configs.go      — Структура configs которая аггрегирует все configs из всех слоев
    ├── exec.go         — Функция запуска всех слоев, парсинга конфигов в единую структуру, запуска всех приложений и вовзрата error при ошибке
    ├── main.go         — Точка запускасистемы с main функцией которая запускает функцию exec и логирует ошибку при наличии 

└── apps/               — движки: HTTP-сервер, consumer, scheduler, CLI
    ├── configs.go      — Структура configs которая аггрегирует все configs всех apps
    ├── main.go         — точка входа в слой, список объектов app, глобальные функции Init которая принимает в качесвте аргумента объект configs и функцию Exec() []error которая запускает все приложения 
    ├── interface.go    — описание интерфейса App, для удобства реализации функций в main.go
    ├── http_server/    — папка с app которая обертывает http сервер
        ├── configs.go  — Структура configs для http_server (port, timeout, api_path, etc...)
        ├── app.go      — Реилизация приватной структуры app, реализующая технологию http-server, с глобальной функций конструктором NewApp(configs Configs) apps.Interface которая принимает объект configs 
    └── rabbit_consumer/ — сам опиши
```
